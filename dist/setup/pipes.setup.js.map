{"version":3,"sources":["../../src/setup/pipes.setup.ts"],"sourcesContent":["import { INestApplication, ValidationPipe } from '@nestjs/common';\nimport { ValidationError } from 'class-validator';\nimport { DomainExceptionCode } from 'src/core/exceptions/domain-exception-codes';\nimport {\n  DomainException,\n  Extension,\n} from 'src/core/exceptions/domain-exceptions';\n\nexport const errorsFormatter = (\n  errors: ValidationError[],\n  errorMessage?: Extension[],\n): Extension[] => {\n  const errorsForResp = errorMessage || [];\n  for (const error of errors) {\n    if (!error.constraints && error.children?.length) {\n      errorsFormatter(error.children, errorsForResp);\n    } else if (error.constraints) {\n      const constraintsKeys = Object.keys(error.constraints);\n      constraintsKeys.forEach((key) => {\n        errorsForResp.push({\n          message: error.constraints![key]\n            ? `${error.constraints![key]}; Received value: ${error?.value}`\n            : '',\n          key: error.property,\n        });\n      });\n    }\n  }\n  return errorsForResp;\n};\n\nexport function pipesSetup(app: INestApplication) {\n  app\n    .useGlobalPipes\n    // new ValidationPipe({\n    //   transform: true,\n    //   whitelist: true,\n    //   stopAtFirstError: true,\n    //   exceptionFactory: (errors) => {\n    //     const formattedErrors = errorsFormatter(errors);\n    //     throw new DomainException({\n    //       code: DomainExceptionCode.ValidationError,\n    //       message: 'validation failed',\n    //       extensions: formattedErrors,\n    //     });\n    //   },\n    // }),\n    ();\n}\n"],"names":["errorsFormatter","pipesSetup","errors","errorMessage","errorsForResp","error","constraints","children","length","constraintsKeys","Object","keys","forEach","key","push","message","value","property","app","useGlobalPipes"],"mappings":";;;;;;;;;;;QAQaA;eAAAA;;QAuBGC;eAAAA;;;AAvBT,MAAMD,kBAAkB,CAC7BE,QACAC;IAEA,MAAMC,gBAAgBD,gBAAgB,EAAE;IACxC,KAAK,MAAME,SAASH,OAAQ;QAC1B,IAAI,CAACG,MAAMC,WAAW,IAAID,MAAME,QAAQ,EAAEC,QAAQ;YAChDR,gBAAgBK,MAAME,QAAQ,EAAEH;QAClC,OAAO,IAAIC,MAAMC,WAAW,EAAE;YAC5B,MAAMG,kBAAkBC,OAAOC,IAAI,CAACN,MAAMC,WAAW;YACrDG,gBAAgBG,OAAO,CAAC,CAACC;gBACvBT,cAAcU,IAAI,CAAC;oBACjBC,SAASV,MAAMC,WAAW,AAAC,CAACO,IAAI,GAC5B,GAAGR,MAAMC,WAAW,AAAC,CAACO,IAAI,CAAC,kBAAkB,EAAER,OAAOW,OAAO,GAC7D;oBACJH,KAAKR,MAAMY,QAAQ;gBACrB;YACF;QACF;IACF;IACA,OAAOb;AACT;AAEO,SAASH,WAAWiB,GAAqB;IAC9CA,IACGC,cAAc;AAenB"}