{"version":3,"sources":["../../../../../src/modules/user-accounts/guards/bearer/jwt-refresh-token-guard.ts"],"sourcesContent":["import {\n  Injectable,\n  ExecutionContext,\n  CanActivate,\n  Inject,\n} from '@nestjs/common';\nimport { JwtService } from '@nestjs/jwt';\nimport { Request } from 'express';\nimport { DomainExceptionCode } from 'src/core/exceptions/domain-exception-codes';\nimport { DomainException } from 'src/core/exceptions/domain-exceptions';\nimport { REFRESH_TOKEN_STRATEGY_INJECT_TOKEN } from '../../constants/auth-token.inject-constants';\n\n@Injectable()\nexport class RefreshTokenGuard implements CanActivate {\n  constructor(\n    @Inject(REFRESH_TOKEN_STRATEGY_INJECT_TOKEN)\n    private readonly jwtRefreshTokService: JwtService,\n  ) {}\n  async canActivate(context: ExecutionContext): Promise<boolean> {\n    const req = context.switchToHttp().getRequest<Request>();\n    const refreshToken: string | undefined = req.cookies.refreshToken as string;\n    if (!refreshToken) {\n      throw new DomainException({\n        code: DomainExceptionCode.Unauthorized,\n        message: 'No refresh token present in cookies',\n      });\n    }\n    try {\n      await this.jwtRefreshTokService.verify(refreshToken);\n    } catch {\n      throw new DomainException({\n        code: DomainExceptionCode.Unauthorized,\n        message: 'Invalid refresh token presented',\n      });\n    }\n    return true;\n  }\n}\n"],"names":["RefreshTokenGuard","canActivate","context","req","switchToHttp","getRequest","refreshToken","cookies","DomainException","code","DomainExceptionCode","Unauthorized","message","jwtRefreshTokService","verify","constructor"],"mappings":";;;;+BAaaA;;;eAAAA;;;wBARN;qBACoB;sCAES;kCACJ;0CACoB;;;;;;;;;;;;;;;AAG7C,IAAA,AAAMA,oBAAN,MAAMA;IAKX,MAAMC,YAAYC,OAAyB,EAAoB;QAC7D,MAAMC,MAAMD,QAAQE,YAAY,GAAGC,UAAU;QAC7C,MAAMC,eAAmCH,IAAII,OAAO,CAACD,YAAY;QACjE,IAAI,CAACA,cAAc;YACjB,MAAM,IAAIE,iCAAe,CAAC;gBACxBC,MAAMC,yCAAmB,CAACC,YAAY;gBACtCC,SAAS;YACX;QACF;QACA,IAAI;YACF,MAAM,IAAI,CAACC,oBAAoB,CAACC,MAAM,CAACR;QACzC,EAAE,OAAM;YACN,MAAM,IAAIE,iCAAe,CAAC;gBACxBC,MAAMC,yCAAmB,CAACC,YAAY;gBACtCC,SAAS;YACX;QACF;QACA,OAAO;IACT;IAtBAG,YACE,AACiBF,oBAAgC,CACjD;aADiBA,uBAAAA;IAChB;AAoBL"}