{"version":3,"sources":["../../../../../src/modules/user-accounts/application/usecases/confirm-user-email.usecase.ts"],"sourcesContent":["import { CommandHandler, ICommandHandler } from '@nestjs/cqrs';\nimport { DomainExceptionCode } from 'src/core/exceptions/domain-exception-codes';\nimport {\n  DomainException,\n  Extension,\n} from 'src/core/exceptions/domain-exceptions';\nimport { UsersRepository } from '../../infrastructure/users.repository';\nimport { UUID } from 'crypto';\n\nexport class ConfirmUserEmailCommand {\n  constructor(public code: UUID) {}\n}\n\n@CommandHandler(ConfirmUserEmailCommand)\nexport class ConfirmUserEmailHandler\n  implements ICommandHandler<ConfirmUserEmailCommand>\n{\n  constructor(private readonly usersRepository: UsersRepository) {}\n\n  async execute(command: ConfirmUserEmailCommand): Promise<any> {\n    const user = await this.usersRepository.findUserByEmailConfirmation(\n      command.code,\n    );\n    if (!user) {\n      throw new DomainException({\n        code: DomainExceptionCode.BadRequest,\n        message: 'User with provided code does not exist',\n        extensions: [\n          new Extension('User with provided code does not exist', 'code'),\n        ],\n      });\n    }\n    user.confirmEmail();\n    await this.usersRepository.save(user);\n    return;\n  }\n}\n"],"names":["ConfirmUserEmailCommand","ConfirmUserEmailHandler","constructor","code","execute","command","user","usersRepository","findUserByEmailConfirmation","DomainException","DomainExceptionCode","BadRequest","message","extensions","Extension","confirmEmail","save"],"mappings":";;;;;;;;;;;QASaA;eAAAA;;QAKAC;eAAAA;;;sBAdmC;sCACZ;kCAI7B;iCACyB;;;;;;;;;;AAGzB,IAAA,AAAMD,0BAAN,MAAMA;IACXE,YAAY,AAAOC,IAAU,CAAE;aAAZA,OAAAA;IAAa;AAClC;AAGO,IAAA,AAAMF,0BAAN,MAAMA;IAKX,MAAMG,QAAQC,OAAgC,EAAgB;QAC5D,MAAMC,OAAO,MAAM,IAAI,CAACC,eAAe,CAACC,2BAA2B,CACjEH,QAAQF,IAAI;QAEd,IAAI,CAACG,MAAM;YACT,MAAM,IAAIG,iCAAe,CAAC;gBACxBN,MAAMO,yCAAmB,CAACC,UAAU;gBACpCC,SAAS;gBACTC,YAAY;oBACV,IAAIC,2BAAS,CAAC,0CAA0C;iBACzD;YACH;QACF;QACAR,KAAKS,YAAY;QACjB,MAAM,IAAI,CAACR,eAAe,CAACS,IAAI,CAACV;QAChC;IACF;IAlBAJ,YAAY,AAAiBK,eAAgC,CAAE;aAAlCA,kBAAAA;IAAmC;AAmBlE"}