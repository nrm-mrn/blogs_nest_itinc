{"version":3,"sources":["../../../../../src/modules/user-accounts/application/usecases/logout-all-other-sessions.usecase.ts"],"sourcesContent":["import { Inject } from '@nestjs/common';\nimport { CommandHandler, ICommandHandler } from '@nestjs/cqrs';\nimport { JwtService } from '@nestjs/jwt';\nimport { REFRESH_TOKEN_STRATEGY_INJECT_TOKEN } from '../../constants/auth-token.inject-constants';\nimport { CreateRefreshTokenDto } from '../../dto/create-refresh-token.dto';\nimport { DevicesSecurityRepository } from '../../infrastructure/devices-security.repository';\n\nexport class LogoutOtherSessionsCommand {\n  constructor(public token: string) {}\n}\n\n@CommandHandler(LogoutOtherSessionsCommand)\nexport class LogoutOtherSessionHandler\n  implements ICommandHandler<LogoutOtherSessionsCommand>\n{\n  constructor(\n    private readonly sessionsRepository: DevicesSecurityRepository,\n    @Inject(REFRESH_TOKEN_STRATEGY_INJECT_TOKEN)\n    private readonly jwtRefreshTokService: JwtService,\n  ) {}\n\n  async execute(command: LogoutOtherSessionsCommand): Promise<any> {\n    const payload = this.jwtRefreshTokService.decode<CreateRefreshTokenDto>(\n      command.token,\n    );\n    const deviceId = payload.deviceId;\n\n    await this.sessionsRepository.findSessionOrFail(deviceId, payload.iat);\n    return this.sessionsRepository.deleteOtherSessions(\n      payload.iat,\n      payload.userId,\n    );\n  }\n}\n"],"names":["LogoutOtherSessionHandler","LogoutOtherSessionsCommand","constructor","token","execute","command","payload","jwtRefreshTokService","decode","deviceId","sessionsRepository","findSessionOrFail","iat","deleteOtherSessions","userId"],"mappings":";;;;;;;;;;;QAYaA;eAAAA;;QALAC;eAAAA;;;wBAPU;sBACyB;qBACrB;0CACyB;2CAEV;;;;;;;;;;;;;;;AAEnC,IAAA,AAAMA,6BAAN,MAAMA;IACXC,YAAY,AAAOC,KAAa,CAAE;aAAfA,QAAAA;IAAgB;AACrC;AAGO,IAAA,AAAMH,4BAAN,MAAMA;IASX,MAAMI,QAAQC,OAAmC,EAAgB;QAC/D,MAAMC,UAAU,IAAI,CAACC,oBAAoB,CAACC,MAAM,CAC9CH,QAAQF,KAAK;QAEf,MAAMM,WAAWH,QAAQG,QAAQ;QAEjC,MAAM,IAAI,CAACC,kBAAkB,CAACC,iBAAiB,CAACF,UAAUH,QAAQM,GAAG;QACrE,OAAO,IAAI,CAACF,kBAAkB,CAACG,mBAAmB,CAChDP,QAAQM,GAAG,EACXN,QAAQQ,MAAM;IAElB;IAjBAZ,YACE,AAAiBQ,kBAA6C,EAC9D,AACiBH,oBAAgC,CACjD;aAHiBG,qBAAAA;aAEAH,uBAAAA;IAChB;AAcL"}