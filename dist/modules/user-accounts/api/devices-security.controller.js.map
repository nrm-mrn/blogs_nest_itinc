{"version":3,"sources":["../../../../src/modules/user-accounts/api/devices-security.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Delete,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Param,\n  Req,\n  UseGuards,\n} from '@nestjs/common';\nimport { SessionsService } from '../application/devices-security.service';\nimport { JwtService } from '@nestjs/jwt';\nimport { SessionsQueryRepository } from '../infrastructure/query/devices-security.query-repository';\nimport { RefreshTokenGuard } from '../guards/bearer/jwt-refresh-token-guard';\nimport { Request } from 'express';\nimport { CreateRefreshTokenDto } from '../dto/create-refresh-token.dto';\nimport { ObjectIdValidationPipe } from 'src/core/pipes/object-id-validation-pipe.service';\n\n@UseGuards(RefreshTokenGuard)\n@Controller('devices')\nexport class DevicesSecurityController {\n  constructor(\n    private readonly sessionsService: SessionsService,\n    private readonly jwtService: JwtService,\n    private readonly sessionsQueryRepo: SessionsQueryRepository,\n  ) {}\n\n  @Get()\n  @HttpCode(HttpStatus.OK)\n  async getDevices(@Req() req: Request) {\n    const token = req.cookies.refreshToken as string;\n    const payload = this.jwtService.decode<CreateRefreshTokenDto>(token);\n    return this.sessionsQueryRepo.getSessionsOrFail(payload.userId);\n  }\n\n  @Delete(':deviceId')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteAnotherSession(\n    @Req() req: Request,\n    @Param('deviceId', ObjectIdValidationPipe) deviceId: string,\n  ) {\n    const token = req.cookies.refreshToken as string;\n    await this.sessionsService.deleteAnotherSession(token, deviceId);\n  }\n\n  @Delete()\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteOtherSessions(@Req() req: Request) {\n    return this.sessionsService.deleteOtherSessions(req.cookies.refreshToken);\n  }\n}\n"],"names":["DevicesSecurityController","getDevices","req","token","cookies","refreshToken","payload","jwtService","decode","sessionsQueryRepo","getSessionsOrFail","userId","deleteAnotherSession","deviceId","sessionsService","deleteOtherSessions","constructor","OK","NO_CONTENT"],"mappings":";;;;+BAoBaA;;;eAAAA;;;wBAXN;wCACyB;qBACL;gDACa;sCACN;yBACV;+CAEe;;;;;;;;;;;;;;;AAIhC,IAAA,AAAMA,4BAAN,MAAMA;IAOX,MAEMC,WAAW,AAAOC,GAAY,EAAE;QACpC,MAAMC,QAAQD,IAAIE,OAAO,CAACC,YAAY;QACtC,MAAMC,UAAU,IAAI,CAACC,UAAU,CAACC,MAAM,CAAwBL;QAC9D,OAAO,IAAI,CAACM,iBAAiB,CAACC,iBAAiB,CAACJ,QAAQK,MAAM;IAChE;IAEA,MAEMC,qBACJ,AAAOV,GAAY,EACnB,AAA2CW,QAAgB,EAC3D;QACA,MAAMV,QAAQD,IAAIE,OAAO,CAACC,YAAY;QACtC,MAAM,IAAI,CAACS,eAAe,CAACF,oBAAoB,CAACT,OAAOU;IACzD;IAEA,MAEME,oBAAoB,AAAOb,GAAY,EAAE;QAC7C,OAAO,IAAI,CAACY,eAAe,CAACC,mBAAmB,CAACb,IAAIE,OAAO,CAACC,YAAY;IAC1E;IA5BAW,YACE,AAAiBF,eAAgC,EACjD,AAAiBP,UAAsB,EACvC,AAAiBE,iBAA0C,CAC3D;aAHiBK,kBAAAA;aACAP,aAAAA;aACAE,oBAAAA;IAChB;AAyBL;;;6CAtBuBQ;;;;;;;;;;6CAQAC;;;;;;;;;;;;6CAUAA"}