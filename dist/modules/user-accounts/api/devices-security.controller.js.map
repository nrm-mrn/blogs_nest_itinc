{"version":3,"sources":["../../../../src/modules/user-accounts/api/devices-security.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Delete,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Inject,\n  Param,\n  Req,\n  UseGuards,\n} from '@nestjs/common';\nimport { SessionsService } from '../application/devices-security.service';\nimport { JwtService } from '@nestjs/jwt';\nimport { SessionsQueryRepository } from '../infrastructure/query/devices-security.query-repository';\nimport { RefreshTokenGuard } from '../guards/bearer/jwt-refresh-token-guard';\nimport { Request } from 'express';\nimport { CreateRefreshTokenDto } from '../dto/create-refresh-token.dto';\nimport { ObjectIdValidationPipe } from 'src/core/pipes/object-id-validation-pipe.service';\nimport { REFRESH_TOKEN_STRATEGY_INJECT_TOKEN } from '../constants/auth-token.inject-constants';\n\n@UseGuards(RefreshTokenGuard)\n@Controller('devices')\nexport class DevicesSecurityController {\n  constructor(\n    private readonly sessionsService: SessionsService,\n    @Inject(REFRESH_TOKEN_STRATEGY_INJECT_TOKEN)\n    private readonly jwtRefreshTokService: JwtService,\n    private readonly sessionsQueryRepo: SessionsQueryRepository,\n  ) {}\n\n  @Get()\n  @HttpCode(HttpStatus.OK)\n  async getDevices(@Req() req: Request) {\n    const token = req.cookies.refreshToken as string;\n    const payload =\n      this.jwtRefreshTokService.decode<CreateRefreshTokenDto>(token);\n    return this.sessionsQueryRepo.getSessionsOrFail(payload.userId);\n  }\n\n  @Delete(':deviceId')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteAnotherSession(\n    @Req() req: Request,\n    @Param('deviceId', ObjectIdValidationPipe) deviceId: string,\n  ) {\n    const token = req.cookies.refreshToken as string;\n    await this.sessionsService.deleteAnotherSession(token, deviceId);\n  }\n\n  @Delete()\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteOtherSessions(@Req() req: Request) {\n    return this.sessionsService.deleteOtherSessions(\n      req.cookies.refreshToken as string,\n    );\n  }\n}\n"],"names":["DevicesSecurityController","getDevices","req","token","cookies","refreshToken","payload","jwtRefreshTokService","decode","sessionsQueryRepo","getSessionsOrFail","userId","deleteAnotherSession","deviceId","sessionsService","deleteOtherSessions","constructor","OK","NO_CONTENT"],"mappings":";;;;+BAsBaA;;;eAAAA;;;wBAZN;wCACyB;qBACL;gDACa;sCACN;yBACV;+CAEe;0CACa;;;;;;;;;;;;;;;AAI7C,IAAA,AAAMA,4BAAN,MAAMA;IAQX,MAEMC,WAAW,AAAOC,GAAY,EAAE;QACpC,MAAMC,QAAQD,IAAIE,OAAO,CAACC,YAAY;QACtC,MAAMC,UACJ,IAAI,CAACC,oBAAoB,CAACC,MAAM,CAAwBL;QAC1D,OAAO,IAAI,CAACM,iBAAiB,CAACC,iBAAiB,CAACJ,QAAQK,MAAM;IAChE;IAEA,MAEMC,qBACJ,AAAOV,GAAY,EACnB,AAA2CW,QAAgB,EAC3D;QACA,MAAMV,QAAQD,IAAIE,OAAO,CAACC,YAAY;QACtC,MAAM,IAAI,CAACS,eAAe,CAACF,oBAAoB,CAACT,OAAOU;IACzD;IAEA,MAEME,oBAAoB,AAAOb,GAAY,EAAE;QAC7C,OAAO,IAAI,CAACY,eAAe,CAACC,mBAAmB,CAC7Cb,IAAIE,OAAO,CAACC,YAAY;IAE5B;IAhCAW,YACE,AAAiBF,eAAgC,EACjD,AACiBP,oBAAgC,EACjD,AAAiBE,iBAA0C,CAC3D;aAJiBK,kBAAAA;aAEAP,uBAAAA;aACAE,oBAAAA;IAChB;AA4BL;;;6CAzBuBQ;;;;;;;;;;6CASAC;;;;;;;;;;;;6CAUAA"}