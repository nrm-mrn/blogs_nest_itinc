{"version":3,"sources":["../../../../src/modules/user-accounts/api/devices-security.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Delete,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Param,\n  Req,\n  UseGuards,\n} from '@nestjs/common';\nimport { RefreshTokenGuard } from '../guards/bearer/jwt-refresh-token-guard';\nimport { Request } from 'express';\nimport { ObjectIdValidationPipe } from 'src/core/pipes/object-id-validation-pipe.service';\nimport { CommandBus, QueryBus } from '@nestjs/cqrs';\nimport { LogoutAnotherSessionCommand } from '../application/usecases/logout-another-session.usecase';\nimport { LogoutOtherSessionsCommand } from '../application/usecases/logout-all-other-sessions.usecase';\nimport { GetUserSessionsQuery } from '../application/queries/get-all-user-sessions.query';\n\n@UseGuards(RefreshTokenGuard)\n@Controller('security')\nexport class DevicesSecurityController {\n  constructor(\n    private commandBus: CommandBus,\n    private queryBus: QueryBus,\n  ) {}\n\n  @Get('devices')\n  @HttpCode(HttpStatus.OK)\n  async getDevices(@Req() req: Request) {\n    const token = req.cookies.refreshToken as string;\n    return this.queryBus.execute(new GetUserSessionsQuery(token));\n  }\n\n  @Delete('devices/:deviceId')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteAnotherSession(\n    @Req() req: Request,\n    @Param('deviceId', ObjectIdValidationPipe) deviceId: string,\n  ) {\n    const token = req.cookies.refreshToken as string;\n    await this.commandBus.execute(\n      new LogoutAnotherSessionCommand(token, deviceId),\n    );\n  }\n\n  @Delete('devices/')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteOtherSessions(@Req() req: Request) {\n    return this.commandBus.execute(\n      new LogoutOtherSessionsCommand(req.cookies.refreshToken as string),\n    );\n  }\n}\n"],"names":["DevicesSecurityController","getDevices","req","token","cookies","refreshToken","queryBus","execute","GetUserSessionsQuery","deleteAnotherSession","deviceId","commandBus","LogoutAnotherSessionCommand","deleteOtherSessions","LogoutOtherSessionsCommand","constructor","OK","NO_CONTENT"],"mappings":";;;;+BAoBaA;;;eAAAA;;;wBAXN;sCAC2B;yBACV;+CACe;sBACF;6CACO;+CACD;yCACN;;;;;;;;;;;;;;;AAI9B,IAAA,AAAMA,4BAAN,MAAMA;IAMX,MAEMC,WAAW,AAAOC,GAAY,EAAE;QACpC,MAAMC,QAAQD,IAAIE,OAAO,CAACC,YAAY;QACtC,OAAO,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAC,IAAIC,6CAAoB,CAACL;IACxD;IAEA,MAEMM,qBACJ,AAAOP,GAAY,EACnB,AAA2CQ,QAAgB,EAC3D;QACA,MAAMP,QAAQD,IAAIE,OAAO,CAACC,YAAY;QACtC,MAAM,IAAI,CAACM,UAAU,CAACJ,OAAO,CAC3B,IAAIK,wDAA2B,CAACT,OAAOO;IAE3C;IAEA,MAEMG,oBAAoB,AAAOX,GAAY,EAAE;QAC7C,OAAO,IAAI,CAACS,UAAU,CAACJ,OAAO,CAC5B,IAAIO,yDAA0B,CAACZ,IAAIE,OAAO,CAACC,YAAY;IAE3D;IA9BAU,YACE,AAAQJ,UAAsB,EAC9B,AAAQL,QAAkB,CAC1B;aAFQK,aAAAA;aACAL,WAAAA;IACP;AA4BL;;;6CAzBuBU;;;;;;;;;;6CAOAC;;;;;;;;;;;;6CAYAA"}