{"version":3,"sources":["../../../../../../src/modules/bloggers-platform/comments/application/usecases/delete-comment.usecase.ts"],"sourcesContent":["import { CommandHandler, ICommandHandler } from '@nestjs/cqrs';\nimport { CommentsRepository } from '../../infrastructure/comments.repository';\nimport { DomainException } from 'src/core/exceptions/domain-exceptions';\nimport { DomainExceptionCode } from 'src/core/exceptions/domain-exception-codes';\n\nexport class DeleteCommentCommand {\n  constructor(\n    public commentId: string,\n    public userId: string,\n  ) {}\n}\n\n@CommandHandler(DeleteCommentCommand)\nexport class DeleteCommentCommandHandler\n  implements ICommandHandler<DeleteCommentCommand>\n{\n  constructor(private readonly commentsRepository: CommentsRepository) {}\n  async execute(command: DeleteCommentCommand): Promise<any> {\n    const comment = await this.commentsRepository.findCommentByIdOrFail(\n      command.commentId,\n    );\n    if (comment.commentatorInfo.userId !== command.userId) {\n      throw new DomainException({\n        code: DomainExceptionCode.Forbidden,\n        message: 'Could not delete another commentators comment',\n      });\n    }\n    return this.commentsRepository.deleteComment(comment);\n  }\n}\n"],"names":["DeleteCommentCommand","DeleteCommentCommandHandler","constructor","commentId","userId","execute","command","comment","commentsRepository","findCommentByIdOrFail","commentatorInfo","DomainException","code","DomainExceptionCode","Forbidden","message","deleteComment"],"mappings":";;;;;;;;;;;QAKaA;eAAAA;;QAQAC;eAAAA;;;sBAbmC;oCACb;kCACH;sCACI;;;;;;;;;;AAE7B,IAAA,AAAMD,uBAAN,MAAMA;IACXE,YACE,AAAOC,SAAiB,EACxB,AAAOC,MAAc,CACrB;aAFOD,YAAAA;aACAC,SAAAA;IACN;AACL;AAGO,IAAA,AAAMH,8BAAN,MAAMA;IAIX,MAAMI,QAAQC,OAA6B,EAAgB;QACzD,MAAMC,UAAU,MAAM,IAAI,CAACC,kBAAkB,CAACC,qBAAqB,CACjEH,QAAQH,SAAS;QAEnB,IAAII,QAAQG,eAAe,CAACN,MAAM,KAAKE,QAAQF,MAAM,EAAE;YACrD,MAAM,IAAIO,iCAAe,CAAC;gBACxBC,MAAMC,yCAAmB,CAACC,SAAS;gBACnCC,SAAS;YACX;QACF;QACA,OAAO,IAAI,CAACP,kBAAkB,CAACQ,aAAa,CAACT;IAC/C;IAZAL,YAAY,AAAiBM,kBAAsC,CAAE;aAAxCA,qBAAAA;IAAyC;AAaxE"}