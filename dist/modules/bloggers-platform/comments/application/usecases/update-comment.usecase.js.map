{"version":3,"sources":["../../../../../../src/modules/bloggers-platform/comments/application/usecases/update-comment.usecase.ts"],"sourcesContent":["import { CommandHandler, ICommandHandler } from '@nestjs/cqrs';\nimport { CommentsRepository } from '../../infrastructure/comments.repository';\nimport { DomainException } from 'src/core/exceptions/domain-exceptions';\nimport { DomainExceptionCode } from 'src/core/exceptions/domain-exception-codes';\n\nexport class UpdateCommentCommand {\n  constructor(\n    public commentId: string,\n    public userId: string,\n    public content: string,\n  ) {}\n}\n@CommandHandler(UpdateCommentCommand)\nexport class UpdateCommentCommandHandler\n  implements ICommandHandler<UpdateCommentCommand>\n{\n  constructor(private readonly commentsRepository: CommentsRepository) {}\n\n  async execute(command: UpdateCommentCommand): Promise<void> {\n    const comment = await this.commentsRepository.findCommentByIdOrFail(\n      command.commentId,\n    );\n    if (comment.commentatorInfo.userId !== command.userId) {\n      throw new DomainException({\n        code: DomainExceptionCode.Forbidden,\n        message: 'Only comment creator can edit it',\n      });\n    }\n    comment.content = command.content;\n    this.commentsRepository.save(comment);\n    return;\n  }\n}\n"],"names":["UpdateCommentCommand","UpdateCommentCommandHandler","constructor","commentId","userId","content","execute","command","comment","commentsRepository","findCommentByIdOrFail","commentatorInfo","DomainException","code","DomainExceptionCode","Forbidden","message","save"],"mappings":";;;;;;;;;;;QAKaA;eAAAA;;QAQAC;eAAAA;;;sBAbmC;oCACb;kCACH;sCACI;;;;;;;;;;AAE7B,IAAA,AAAMD,uBAAN,MAAMA;IACXE,YACE,AAAOC,SAAiB,EACxB,AAAOC,MAAc,EACrB,AAAOC,OAAe,CACtB;aAHOF,YAAAA;aACAC,SAAAA;aACAC,UAAAA;IACN;AACL;AAEO,IAAA,AAAMJ,8BAAN,MAAMA;IAKX,MAAMK,QAAQC,OAA6B,EAAiB;QAC1D,MAAMC,UAAU,MAAM,IAAI,CAACC,kBAAkB,CAACC,qBAAqB,CACjEH,QAAQJ,SAAS;QAEnB,IAAIK,QAAQG,eAAe,CAACP,MAAM,KAAKG,QAAQH,MAAM,EAAE;YACrD,MAAM,IAAIQ,iCAAe,CAAC;gBACxBC,MAAMC,yCAAmB,CAACC,SAAS;gBACnCC,SAAS;YACX;QACF;QACAR,QAAQH,OAAO,GAAGE,QAAQF,OAAO;QACjC,IAAI,CAACI,kBAAkB,CAACQ,IAAI,CAACT;QAC7B;IACF;IAfAN,YAAY,AAAiBO,kBAAsC,CAAE;aAAxCA,qBAAAA;IAAyC;AAgBxE"}