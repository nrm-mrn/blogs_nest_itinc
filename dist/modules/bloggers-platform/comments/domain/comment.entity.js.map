{"version":3,"sources":["../../../../../src/modules/bloggers-platform/comments/domain/comment.entity.ts"],"sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\nimport {\n  CommentatorInfo,\n  CommentatorInfoSchema,\n} from './commentator-info.schema';\nimport { CreateCommentDomainDto } from './dto/create-comment-domain-dto';\nimport { HydratedDocument, Model } from 'mongoose';\nimport { UpdateCommentDomainDto } from './dto/update-comment-domain-dto';\nimport { DomainException } from 'src/core/exceptions/domain-exceptions';\nimport { DomainExceptionCode } from 'src/core/exceptions/domain-exception-codes';\n\nexport const commentContentConstr = {\n  minLength: 20,\n  maxLength: 300,\n};\n\n@Schema({ timestamps: true })\nexport class Comment {\n  @Prop({ type: String, required: true })\n  postId: string;\n\n  @Prop({ type: String, required: true, ...commentContentConstr })\n  content: string;\n\n  @Prop({ type: CommentatorInfoSchema, required: true })\n  commentatorInfo: CommentatorInfo;\n\n  @Prop({ type: Number, default: 0 })\n  likesCount: number;\n\n  @Prop({ type: Number, default: 0 })\n  dislikesCount: number;\n\n  createdAt: Date;\n\n  @Prop({ type: Date, nullable: true, default: null })\n  deletedAt: Date;\n\n  static createComment(dto: CreateCommentDomainDto): CommentDocument {\n    const comment = new this();\n    comment.postId = dto.postId;\n    comment.content = dto.content;\n    comment.commentatorInfo = {\n      userId: dto.userId,\n      userLogin: dto.userLogin,\n    };\n    comment.likesCount = 0;\n    comment.dislikesCount = 0;\n\n    return comment as CommentDocument;\n  }\n\n  updateComment(dto: UpdateCommentDomainDto) {\n    this.content = dto.content;\n  }\n\n  addLike() {\n    this.likesCount += 1;\n  }\n\n  removeLike() {\n    this.likesCount -= 1;\n  }\n\n  addDislike() {\n    this.dislikesCount += 1;\n  }\n\n  removeDislike() {\n    this.dislikesCount -= 1;\n  }\n\n  markDeleted() {\n    if (this.deletedAt !== null) {\n      throw new DomainException({\n        code: DomainExceptionCode.NotFound,\n        message: 'Entity is already deleted',\n      });\n    }\n    this.deletedAt = new Date();\n  }\n}\n\nexport type CommentDocument = HydratedDocument<Comment>;\nexport type CommentModelType = Model<CommentDocument> & typeof Comment;\nexport const CommentSchema = SchemaFactory.createForClass(Comment);\n\nCommentSchema.loadClass(Comment);\n"],"names":["Comment","CommentSchema","commentContentConstr","minLength","maxLength","createComment","dto","comment","postId","content","commentatorInfo","userId","userLogin","likesCount","dislikesCount","updateComment","addLike","removeLike","addDislike","removeDislike","markDeleted","deletedAt","DomainException","code","DomainExceptionCode","NotFound","message","Date","type","String","required","CommentatorInfoSchema","Number","default","nullable","timestamps","SchemaFactory","createForClass","loadClass"],"mappings":";;;;;;;;;;;QAiBaA;eAAAA;;QAoEAC;eAAAA;;QA1EAC;eAAAA;;;0BAX+B;uCAIrC;kCAIyB;sCACI;;;;;;;;;;AAE7B,MAAMA,uBAAuB;IAClCC,WAAW;IACXC,WAAW;AACb;AAGO,IAAA,AAAMJ,UAAN,MAAMA;IAqBX,OAAOK,cAAcC,GAA2B,EAAmB;QACjE,MAAMC,UAAU,IAAI,IAAI;QACxBA,QAAQC,MAAM,GAAGF,IAAIE,MAAM;QAC3BD,QAAQE,OAAO,GAAGH,IAAIG,OAAO;QAC7BF,QAAQG,eAAe,GAAG;YACxBC,QAAQL,IAAIK,MAAM;YAClBC,WAAWN,IAAIM,SAAS;QAC1B;QACAL,QAAQM,UAAU,GAAG;QACrBN,QAAQO,aAAa,GAAG;QAExB,OAAOP;IACT;IAEAQ,cAAcT,GAA2B,EAAE;QACzC,IAAI,CAACG,OAAO,GAAGH,IAAIG,OAAO;IAC5B;IAEAO,UAAU;QACR,IAAI,CAACH,UAAU,IAAI;IACrB;IAEAI,aAAa;QACX,IAAI,CAACJ,UAAU,IAAI;IACrB;IAEAK,aAAa;QACX,IAAI,CAACJ,aAAa,IAAI;IACxB;IAEAK,gBAAgB;QACd,IAAI,CAACL,aAAa,IAAI;IACxB;IAEAM,cAAc;QACZ,IAAI,IAAI,CAACC,SAAS,KAAK,MAAM;YAC3B,MAAM,IAAIC,iCAAe,CAAC;gBACxBC,MAAMC,yCAAmB,CAACC,QAAQ;gBAClCC,SAAS;YACX;QACF;QACA,IAAI,CAACL,SAAS,GAAG,IAAIM;IACvB;AACF;;;QA/DUC,MAAMC;QAAQC,UAAU;;;;;;QAGxBF,MAAMC;QAAQC,UAAU;QAAM,GAAG5B,oBAAoB;;;;;;QAGrD0B,MAAMG,4CAAqB;QAAED,UAAU;;;;;;QAGvCF,MAAMI;QAAQC,SAAS;;;;;;QAGvBL,MAAMI;QAAQC,SAAS;;;;;;QAKvBL,MAAMD;QAAMO,UAAU;QAAMD,SAAS;;;;;;QAnBrCE,YAAY;;;AAqEf,MAAMlC,gBAAgBmC,uBAAa,CAACC,cAAc,CAACrC;AAE1DC,cAAcqC,SAAS,CAACtC"}