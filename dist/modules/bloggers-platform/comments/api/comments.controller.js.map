{"version":3,"sources":["../../../../../src/modules/bloggers-platform/comments/api/comments.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Delete,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Param,\n  Put,\n  UseGuards,\n} from '@nestjs/common';\nimport { CommandBus, QueryBus } from '@nestjs/cqrs';\nimport { ObjectIdValidationPipe } from 'src/core/pipes/object-id-validation-pipe.service';\nimport { GetCommentQuery } from '../application/queries/get-comment.query';\nimport { JwtOptionalAuthGuard } from 'src/modules/user-accounts/guards/bearer/jwt-optional-guard';\nimport { ExtractUserFromRequestIfExists } from 'src/modules/user-accounts/guards/decorators/extract-user-if-exists-from-request.decorator';\nimport {\n  Nullable,\n  UserContextDto,\n} from 'src/modules/user-accounts/guards/dto/user-context.dto';\nimport { JwtAuthGuard } from 'src/modules/user-accounts/guards/bearer/jwt-auth.guard';\nimport { UpdateCommentInputDto } from './input-dto/update-comment.input-dto';\nimport { ExtractUserFromRequest } from 'src/modules/user-accounts/guards/decorators/extract-user-from-request.decorator';\nimport { CommentViewDto } from './view-dto/comment-view.dto';\nimport { UpdateCommentCommand } from '../application/usecases/update-comment.usecase';\nimport { DeleteCommentCommand } from '../application/usecases/delete-comment.usecase';\nimport { HandleCommentLikeCommand } from '../application/usecases/handle-comment-like.usecase';\nimport { HandleCommentLikeInputDto } from './input-dto/handle-comment-like.input-dto';\n\n@Controller('comments')\nexport class CommentsController {\n  constructor(\n    private readonly queryBus: QueryBus,\n    private readonly commandBus: CommandBus,\n  ) {}\n\n  @UseGuards(JwtOptionalAuthGuard)\n  @Get(':id')\n  @HttpCode(HttpStatus.OK)\n  async getComment(\n    @Param('id', ObjectIdValidationPipe) id: string,\n    @ExtractUserFromRequestIfExists() user: UserContextDto | null,\n  ): Promise<CommentViewDto> {\n    return this.queryBus.execute(new GetCommentQuery(id, user?.userId));\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Put(':id')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async updateComment(\n    @Body() body: UpdateCommentInputDto,\n    @Param('id', ObjectIdValidationPipe) commentId: string,\n    @ExtractUserFromRequest() user: UserContextDto,\n  ): Promise<void> {\n    return this.commandBus.execute(\n      new UpdateCommentCommand(commentId, user.userId, body.content),\n    );\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Delete(':id')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteComment(\n    @Param('id', ObjectIdValidationPipe) commentId: string,\n    @ExtractUserFromRequest() user: UserContextDto,\n  ): Promise<void> {\n    return this.commandBus.execute(\n      new DeleteCommentCommand(commentId, user.userId),\n    );\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Put(':id/like-status')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async handleLike(\n    @Body() body: HandleCommentLikeInputDto,\n    @Param('id', ObjectIdValidationPipe) commentId: string,\n    @ExtractUserFromRequest() user: UserContextDto,\n  ): Promise<void> {\n    return this.commandBus.execute(\n      new HandleCommentLikeCommand(user.userId, commentId, body.likeStatus),\n    );\n  }\n}\n"],"names":["CommentsController","getComment","id","user","queryBus","execute","GetCommentQuery","userId","updateComment","body","commentId","commandBus","UpdateCommentCommand","content","deleteComment","DeleteCommentCommand","handleLike","HandleCommentLikeCommand","likeStatus","constructor","OK","NO_CONTENT"],"mappings":";;;;+BA8BaA;;;eAAAA;;;wBApBN;sBAC8B;+CACE;iCACP;kCACK;yDACU;gCAIxC;8BACsB;uCACS;iDACC;sCAEF;sCACA;0CACI;2CACC;;;;;;;;;;;;;;;AAGnC,IAAA,AAAMA,qBAAN,MAAMA;IAMX,MAGMC,WACJ,AAAqCC,EAAU,EAC/C,AAAkCC,IAA2B,EACpC;QACzB,OAAO,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAC,IAAIC,gCAAe,CAACJ,IAAIC,MAAMI;IAC7D;IAEA,MAGMC,cACJ,AAAQC,IAA2B,EACnC,AAAqCC,SAAiB,EACtD,AAA0BP,IAAoB,EAC/B;QACf,OAAO,IAAI,CAACQ,UAAU,CAACN,OAAO,CAC5B,IAAIO,0CAAoB,CAACF,WAAWP,KAAKI,MAAM,EAAEE,KAAKI,OAAO;IAEjE;IAEA,MAGMC,cACJ,AAAqCJ,SAAiB,EACtD,AAA0BP,IAAoB,EAC/B;QACf,OAAO,IAAI,CAACQ,UAAU,CAACN,OAAO,CAC5B,IAAIU,0CAAoB,CAACL,WAAWP,KAAKI,MAAM;IAEnD;IAEA,MAGMS,WACJ,AAAQP,IAA+B,EACvC,AAAqCC,SAAiB,EACtD,AAA0BP,IAAoB,EAC/B;QACf,OAAO,IAAI,CAACQ,UAAU,CAACN,OAAO,CAC5B,IAAIY,kDAAwB,CAACd,KAAKI,MAAM,EAAEG,WAAWD,KAAKS,UAAU;IAExE;IAnDAC,YACE,AAAiBf,QAAkB,EACnC,AAAiBO,UAAsB,CACvC;aAFiBP,WAAAA;aACAO,aAAAA;IAChB;AAiDL;;;;6CA7CuBS;;;;;;;;;;;;;6CAUAC;;;;;;;;;;;;;;;6CAaAA;;;;;;;;;;;;;6CAYAA"}