{"version":3,"sources":["../../../../../src/modules/bloggers-platform/blogs/infrastructure/blogs.repository.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { InjectModel } from '@nestjs/mongoose';\nimport { Blog, BlogDocument, BlogModelType } from '../domain/blog.entity';\nimport { DomainException } from 'src/core/exceptions/domain-exceptions';\nimport { DomainExceptionCode } from 'src/core/exceptions/domain-exception-codes';\n\n@Injectable()\nexport class BlogsRepository {\n  constructor(@InjectModel(Blog.name) private BlogModel: BlogModelType) {}\n\n  async save(blog: BlogDocument): Promise<string> {\n    await blog.save();\n    return blog._id.toString();\n  }\n\n  async findById(blogId: string): Promise<BlogDocument | null> {\n    const blog = await this.BlogModel.findOne({\n      _id: blogId,\n      deletedAt: null,\n    });\n    return blog;\n  }\n\n  async findOrNotFoundFail(blogId: string): Promise<BlogDocument> {\n    const blog = await this.BlogModel.findOne({\n      _id: blogId,\n      deletedAt: null,\n    }).orFail(\n      new DomainException({\n        code: DomainExceptionCode.NotFound,\n        message: 'Blog not found',\n      }),\n    );\n    return blog;\n  }\n\n  async deleteBlog(blog: BlogDocument) {\n    blog.markDeleted();\n    return this.save(blog);\n  }\n}\n"],"names":["BlogsRepository","save","blog","_id","toString","findById","blogId","BlogModel","findOne","deletedAt","findOrNotFoundFail","orFail","DomainException","code","DomainExceptionCode","NotFound","message","deleteBlog","markDeleted","constructor","name"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPc;0BACC;4BACsB;kCAClB;sCACI;;;;;;;;;;;;;;;AAG7B,IAAA,AAAMA,kBAAN,MAAMA;IAGX,MAAMC,KAAKC,IAAkB,EAAmB;QAC9C,MAAMA,KAAKD,IAAI;QACf,OAAOC,KAAKC,GAAG,CAACC,QAAQ;IAC1B;IAEA,MAAMC,SAASC,MAAc,EAAgC;QAC3D,MAAMJ,OAAO,MAAM,IAAI,CAACK,SAAS,CAACC,OAAO,CAAC;YACxCL,KAAKG;YACLG,WAAW;QACb;QACA,OAAOP;IACT;IAEA,MAAMQ,mBAAmBJ,MAAc,EAAyB;QAC9D,MAAMJ,OAAO,MAAM,IAAI,CAACK,SAAS,CAACC,OAAO,CAAC;YACxCL,KAAKG;YACLG,WAAW;QACb,GAAGE,MAAM,CACP,IAAIC,iCAAe,CAAC;YAClBC,MAAMC,yCAAmB,CAACC,QAAQ;YAClCC,SAAS;QACX;QAEF,OAAOd;IACT;IAEA,MAAMe,WAAWf,IAAkB,EAAE;QACnCA,KAAKgB,WAAW;QAChB,OAAO,IAAI,CAACjB,IAAI,CAACC;IACnB;IA/BAiB,YAAY,AAAgCZ,SAAwB,CAAE;aAA1BA,YAAAA;IAA2B;AAgCzE;;;6DAhCgCa"}