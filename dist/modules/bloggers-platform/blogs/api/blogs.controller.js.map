{"version":3,"sources":["../../../../../src/modules/bloggers-platform/blogs/api/blogs.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Delete,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Param,\n  Post,\n  Put,\n  Query,\n} from '@nestjs/common';\nimport { BlogViewDto } from './view-dto/blogs.view-dto';\nimport { PaginatedViewDto } from 'src/core/dto/base.paginated.view-dto';\nimport {\n  CreateBlogInputDto,\n  UpdateBlogInputDto,\n} from './input-dto/blogs.input-dto';\nimport { GetBlogsQueryParams } from './input-dto/get-blogs-query-params.input-dto';\nimport { BlogsQueryRepository } from '../infrastructure/blogs.query-repository';\nimport { BlogService } from '../application/blog.service';\nimport { CreateBlogDto } from '../dto/create-blog.dto';\nimport { UpdateBlogDto } from '../dto/update-blog.dto';\nimport { ObjectIdValidationPipe } from 'src/core/pipes/object-id-validation-pipe.service';\nimport { CreateBlogPostInputDto } from './input-dto/create-blog-post.input-dto';\nimport { CreateBlogPostDto } from '../dto/create-blog-post.dto';\nimport { PostsQueryRepository } from '../../posts/infrastructure/posts.query-repository';\nimport { PostViewDto } from '../../posts/api/view-dto/posts.view-dto';\nimport { GetBlogPostsDto } from './view-dto/get-blog-posts-dto';\nimport { GetBlogPostsQueryParams } from './input-dto/get-blog-posts-query-params.input-dto';\n\n@Controller('blogs')\nexport class BlogsController {\n  constructor(\n    private readonly blogsQueryRepository: BlogsQueryRepository,\n    private readonly postsQueryRepository: PostsQueryRepository,\n    private readonly blogsService: BlogService,\n  ) {}\n\n  @Get()\n  @HttpCode(HttpStatus.OK)\n  async getBlogs(\n    @Query() query: GetBlogsQueryParams,\n  ): Promise<PaginatedViewDto<BlogViewDto[]>> {\n    return this.blogsQueryRepository.getAllBlogs(query);\n  }\n\n  @Post()\n  @HttpCode(HttpStatus.CREATED)\n  async createBlog(@Body() body: CreateBlogInputDto): Promise<BlogViewDto> {\n    const dto: CreateBlogDto = {\n      name: body.name,\n      description: body.description,\n      websiteUrl: body.websiteUrl,\n    };\n    const { blogId } = await this.blogsService.createBlog(dto);\n    return this.blogsQueryRepository.findBlogOrNotFoundFail(blogId);\n  }\n\n  @Post(':blogId/posts')\n  @HttpCode(HttpStatus.CREATED)\n  async createPostForBlog(\n    //TODO: return ObjectIdValidationPipe\n    @Param('blogId') blogId: string,\n    @Body() body: CreateBlogPostInputDto,\n  ): Promise<PostViewDto> {\n    const dto: CreateBlogPostDto = {\n      blogId,\n      title: body.title,\n      content: body.content,\n      shortDescription: body.shortDescription,\n    };\n    const { postId } = await this.blogsService.createPostForBlog(dto);\n    return this.postsQueryRepository.findPostOrNotFoundFail(postId);\n  }\n\n  @Get(':id')\n  @HttpCode(HttpStatus.OK)\n  async getBlog(\n    @Param('id', ObjectIdValidationPipe) id: string,\n  ): Promise<BlogViewDto> {\n    return this.blogsQueryRepository.findBlogOrNotFoundFail(id);\n  }\n\n  @Get(':blogId/posts')\n  @HttpCode(HttpStatus.OK)\n  async getPostsForBlog(\n    //TODO: return ObjectIdValidationPipe\n    @Param('blogId') blogId: string,\n    @Query() query: GetBlogPostsQueryParams,\n  ): Promise<PaginatedViewDto<PostViewDto[]>> {\n    const dto: GetBlogPostsDto = Object.assign(new GetBlogPostsDto(), query, {\n      blogId,\n    });\n    return this.blogsQueryRepository.getBlogPosts(dto);\n  }\n\n  @Put(':id')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async updateBlog(\n    @Param('id', ObjectIdValidationPipe) id: string,\n    @Body() body: UpdateBlogInputDto,\n  ): Promise<void> {\n    const dto: UpdateBlogDto = {\n      name: body.name,\n      description: body.description,\n      websiteUrl: body.websiteUrl,\n    };\n    await this.blogsService.editBlog(id, dto);\n    return;\n  }\n\n  @Delete(':id')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteBlog(\n    @Param('id', ObjectIdValidationPipe) id: string,\n  ): Promise<void> {\n    return this.blogsService.deleteBlog(id);\n  }\n}\n"],"names":["BlogsController","getBlogs","query","blogsQueryRepository","getAllBlogs","createBlog","body","dto","name","description","websiteUrl","blogId","blogsService","findBlogOrNotFoundFail","createPostForBlog","title","content","shortDescription","postId","postsQueryRepository","findPostOrNotFoundFail","getBlog","id","getPostsForBlog","Object","assign","GetBlogPostsDto","getBlogPosts","updateBlog","editBlog","deleteBlog","constructor","OK","CREATED","NO_CONTENT"],"mappings":";;;;+BAgCaA;;;eAAAA;;;wBArBN;+BAMA;6CAC6B;sCACC;6BACT;+CAGW;wCACA;sCAEF;iCAEL;iDACQ;;;;;;;;;;;;;;;AAGjC,IAAA,AAAMA,kBAAN,MAAMA;IAOX,MAEMC,SACJ,AAASC,KAA0B,EACO;QAC1C,OAAO,IAAI,CAACC,oBAAoB,CAACC,WAAW,CAACF;IAC/C;IAEA,MAEMG,WAAW,AAAQC,IAAwB,EAAwB;QACvE,MAAMC,MAAqB;YACzBC,MAAMF,KAAKE,IAAI;YACfC,aAAaH,KAAKG,WAAW;YAC7BC,YAAYJ,KAAKI,UAAU;QAC7B;QACA,MAAM,EAAEC,MAAM,EAAE,GAAG,MAAM,IAAI,CAACC,YAAY,CAACP,UAAU,CAACE;QACtD,OAAO,IAAI,CAACJ,oBAAoB,CAACU,sBAAsB,CAACF;IAC1D;IAEA,MAEMG,kBACJ,qCAAqC;IACpBH,MAAc,EAC/B,AAAQL,IAA4B,EACd;QACtB,MAAMC,MAAyB;YAC7BI;YACAI,OAAOT,KAAKS,KAAK;YACjBC,SAASV,KAAKU,OAAO;YACrBC,kBAAkBX,KAAKW,gBAAgB;QACzC;QACA,MAAM,EAAEC,MAAM,EAAE,GAAG,MAAM,IAAI,CAACN,YAAY,CAACE,iBAAiB,CAACP;QAC7D,OAAO,IAAI,CAACY,oBAAoB,CAACC,sBAAsB,CAACF;IAC1D;IAEA,MAEMG,QACJ,AAAqCC,EAAU,EACzB;QACtB,OAAO,IAAI,CAACnB,oBAAoB,CAACU,sBAAsB,CAACS;IAC1D;IAEA,MAEMC,gBACJ,qCAAqC;IACpBZ,MAAc,EAC/B,AAAST,KAA8B,EACG;QAC1C,MAAMK,MAAuBiB,OAAOC,MAAM,CAAC,IAAIC,gCAAe,IAAIxB,OAAO;YACvES;QACF;QACA,OAAO,IAAI,CAACR,oBAAoB,CAACwB,YAAY,CAACpB;IAChD;IAEA,MAEMqB,WACJ,AAAqCN,EAAU,EAC/C,AAAQhB,IAAwB,EACjB;QACf,MAAMC,MAAqB;YACzBC,MAAMF,KAAKE,IAAI;YACfC,aAAaH,KAAKG,WAAW;YAC7BC,YAAYJ,KAAKI,UAAU;QAC7B;QACA,MAAM,IAAI,CAACE,YAAY,CAACiB,QAAQ,CAACP,IAAIf;QACrC;IACF;IAEA,MAEMuB,WACJ,AAAqCR,EAAU,EAChC;QACf,OAAO,IAAI,CAACV,YAAY,CAACkB,UAAU,CAACR;IACtC;IArFAS,YACE,AAAiB5B,oBAA0C,EAC3D,AAAiBgB,oBAA0C,EAC3D,AAAiBP,YAAyB,CAC1C;aAHiBT,uBAAAA;aACAgB,uBAAAA;aACAP,eAAAA;IAChB;AAkFL;;;6CA/EuBoB;;;;;;;;;;6CAQAC;;;;;;;;;;6CAYAA;;;;;;;;;;;;6CAiBAD;;;;;;;;;;6CAQAA;;;;;;;;;;;;6CAaAE;;;;;;;;;;;;6CAeAA"}