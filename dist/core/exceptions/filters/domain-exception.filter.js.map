{"version":3,"sources":["../../../../src/core/exceptions/filters/domain-exception.filter.ts"],"sourcesContent":["import {\n  ArgumentsHost,\n  Catch,\n  ExceptionFilter,\n  HttpStatus,\n} from '@nestjs/common';\nimport { DomainException, Extension } from '../domain-exceptions';\nimport { Response } from 'express';\nimport { DomainExceptionCode } from '../domain-exception-codes';\nimport { APIErrorResult, FieldError } from '../api-error.result';\n\n@Catch(DomainException)\nexport class DomainHttpExceptionFilter implements ExceptionFilter {\n  catch(exception: DomainException, host: ArgumentsHost) {\n    const ctx = host.switchToHttp();\n    const response = ctx.getResponse<Response>();\n    const code = this.mapToHttpStatus(exception.code);\n    let body = {};\n    if (exception.extensions) {\n      body = this.buildResponseBody(exception.extensions);\n    }\n    response.status(code).json(body);\n  }\n\n  private mapToHttpStatus(code: DomainExceptionCode): number {\n    switch (code) {\n      case DomainExceptionCode.BadRequest:\n      case DomainExceptionCode.ValidationError:\n      case DomainExceptionCode.ConfirmationCodeExpired:\n      case DomainExceptionCode.EmailNotConfirmed:\n      case DomainExceptionCode.PasswordRecoveryCodeExpired:\n        return HttpStatus.BAD_REQUEST;\n      case DomainExceptionCode.Forbidden:\n        return HttpStatus.FORBIDDEN;\n      case DomainExceptionCode.NotFound:\n        return HttpStatus.NOT_FOUND;\n      case DomainExceptionCode.Unauthorized:\n        return HttpStatus.UNAUTHORIZED;\n      case DomainExceptionCode.InternalServerError:\n        return HttpStatus.INTERNAL_SERVER_ERROR;\n      default:\n        return HttpStatus.I_AM_A_TEAPOT;\n    }\n  }\n\n  private buildResponseBody(extensions: Extension[]): APIErrorResult {\n    const res: FieldError[] = [];\n    extensions.forEach((ext) => {\n      res.push(new FieldError(ext.message, ext.key));\n    });\n    return { errorsMessages: res };\n  }\n}\n"],"names":["DomainHttpExceptionFilter","catch","exception","host","ctx","switchToHttp","response","getResponse","code","mapToHttpStatus","body","extensions","buildResponseBody","status","json","DomainExceptionCode","BadRequest","ValidationError","ConfirmationCodeExpired","EmailNotConfirmed","PasswordRecoveryCodeExpired","HttpStatus","BAD_REQUEST","Forbidden","FORBIDDEN","NotFound","NOT_FOUND","Unauthorized","UNAUTHORIZED","InternalServerError","INTERNAL_SERVER_ERROR","I_AM_A_TEAPOT","res","forEach","ext","push","FieldError","message","key","errorsMessages"],"mappings":";;;;+BAYaA;;;eAAAA;;;wBAPN;kCACoC;sCAEP;gCACO;;;;;;;AAGpC,IAAA,AAAMA,4BAAN,MAAMA;IACXC,MAAMC,SAA0B,EAAEC,IAAmB,EAAE;QACrD,MAAMC,MAAMD,KAAKE,YAAY;QAC7B,MAAMC,WAAWF,IAAIG,WAAW;QAChC,MAAMC,OAAO,IAAI,CAACC,eAAe,CAACP,UAAUM,IAAI;QAChD,IAAIE,OAAO,CAAC;QACZ,IAAIR,UAAUS,UAAU,EAAE;YACxBD,OAAO,IAAI,CAACE,iBAAiB,CAACV,UAAUS,UAAU;QACpD;QACAL,SAASO,MAAM,CAACL,MAAMM,IAAI,CAACJ;IAC7B;IAEQD,gBAAgBD,IAAyB,EAAU;QACzD,OAAQA;YACN,KAAKO,yCAAmB,CAACC,UAAU;YACnC,KAAKD,yCAAmB,CAACE,eAAe;YACxC,KAAKF,yCAAmB,CAACG,uBAAuB;YAChD,KAAKH,yCAAmB,CAACI,iBAAiB;YAC1C,KAAKJ,yCAAmB,CAACK,2BAA2B;gBAClD,OAAOC,kBAAU,CAACC,WAAW;YAC/B,KAAKP,yCAAmB,CAACQ,SAAS;gBAChC,OAAOF,kBAAU,CAACG,SAAS;YAC7B,KAAKT,yCAAmB,CAACU,QAAQ;gBAC/B,OAAOJ,kBAAU,CAACK,SAAS;YAC7B,KAAKX,yCAAmB,CAACY,YAAY;gBACnC,OAAON,kBAAU,CAACO,YAAY;YAChC,KAAKb,yCAAmB,CAACc,mBAAmB;gBAC1C,OAAOR,kBAAU,CAACS,qBAAqB;YACzC;gBACE,OAAOT,kBAAU,CAACU,aAAa;QACnC;IACF;IAEQnB,kBAAkBD,UAAuB,EAAkB;QACjE,MAAMqB,MAAoB,EAAE;QAC5BrB,WAAWsB,OAAO,CAAC,CAACC;YAClBF,IAAIG,IAAI,CAAC,IAAIC,0BAAU,CAACF,IAAIG,OAAO,EAAEH,IAAII,GAAG;QAC9C;QACA,OAAO;YAAEC,gBAAgBP;QAAI;IAC/B;AACF"}