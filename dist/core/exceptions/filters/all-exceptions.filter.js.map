{"version":3,"sources":["../../../../src/core/exceptions/filters/all-exceptions.filter.ts"],"sourcesContent":["import {\n  ArgumentsHost,\n  Catch,\n  ExceptionFilter,\n  HttpStatus,\n} from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { Request, Response } from 'express';\nimport { ConfigurationType } from 'src/modules/config/config.module';\nimport { DomainExceptionCode } from '../domain-exception-codes';\n\n@Catch()\nexport class AllExceptionFilter implements ExceptionFilter {\n  constructor(\n    private readonly configService: ConfigService<ConfigurationType>,\n  ) {}\n  catch(exception: Error, host: ArgumentsHost): void {\n    const ctx = host.switchToHttp();\n    const res = ctx.getResponse<Response>();\n    const req = ctx.getRequest<Request>();\n\n    const message = exception.message || 'Unknown exception occured';\n    const code = HttpStatus.INTERNAL_SERVER_ERROR;\n    const resBody = this.buildResponseBody(req.url, message);\n    res.status(code).json(resBody);\n  }\n\n  private buildResponseBody(reqUrl: string, message: string) {\n    if (this.configService.get('nodeEnv') === 'production') {\n      return {\n        timestamp: new Date().toISOString(),\n        path: null,\n        message: 'Server error occured',\n        extensions: [],\n        code: DomainExceptionCode.InternalServerError,\n      };\n    } else {\n      return {\n        timestamp: new Date().toISOString(),\n        path: reqUrl,\n        message,\n        extensions: [],\n        code: DomainExceptionCode.InternalServerError,\n      };\n    }\n  }\n}\n"],"names":["AllExceptionFilter","catch","exception","host","ctx","switchToHttp","res","getResponse","req","getRequest","message","code","HttpStatus","INTERNAL_SERVER_ERROR","resBody","buildResponseBody","url","status","json","reqUrl","configService","get","timestamp","Date","toISOString","path","extensions","DomainExceptionCode","InternalServerError","constructor"],"mappings":";;;;+BAYaA;;;eAAAA;;;wBAPN;wBACuB;sCAGM;;;;;;;;;;AAG7B,IAAA,AAAMA,qBAAN,MAAMA;IAIXC,MAAMC,SAAgB,EAAEC,IAAmB,EAAQ;QACjD,MAAMC,MAAMD,KAAKE,YAAY;QAC7B,MAAMC,MAAMF,IAAIG,WAAW;QAC3B,MAAMC,MAAMJ,IAAIK,UAAU;QAE1B,MAAMC,UAAUR,UAAUQ,OAAO,IAAI;QACrC,MAAMC,OAAOC,kBAAU,CAACC,qBAAqB;QAC7C,MAAMC,UAAU,IAAI,CAACC,iBAAiB,CAACP,IAAIQ,GAAG,EAAEN;QAChDJ,IAAIW,MAAM,CAACN,MAAMO,IAAI,CAACJ;IACxB;IAEQC,kBAAkBI,MAAc,EAAET,OAAe,EAAE;QACzD,IAAI,IAAI,CAACU,aAAa,CAACC,GAAG,CAAC,eAAe,cAAc;YACtD,OAAO;gBACLC,WAAW,IAAIC,OAAOC,WAAW;gBACjCC,MAAM;gBACNf,SAAS;gBACTgB,YAAY,EAAE;gBACdf,MAAMgB,yCAAmB,CAACC,mBAAmB;YAC/C;QACF,OAAO;YACL,OAAO;gBACLN,WAAW,IAAIC,OAAOC,WAAW;gBACjCC,MAAMN;gBACNT;gBACAgB,YAAY,EAAE;gBACdf,MAAMgB,yCAAmB,CAACC,mBAAmB;YAC/C;QACF;IACF;IAhCAC,YACE,AAAiBT,aAA+C,CAChE;aADiBA,gBAAAA;IAChB;AA+BL"}