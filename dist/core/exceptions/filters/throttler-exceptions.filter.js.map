{"version":3,"sources":["../../../../src/core/exceptions/filters/throttler-exceptions.filter.ts"],"sourcesContent":["import {\n  ArgumentsHost,\n  Catch,\n  ExceptionFilter,\n  HttpStatus,\n} from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { Request, Response } from 'express';\nimport { ConfigurationType } from 'src/modules/config/config.module';\nimport { ThrottlerException } from '@nestjs/throttler';\n\n@Catch(ThrottlerException)\nexport class ThrottlerExceptionFilter implements ExceptionFilter {\n  constructor(\n    private readonly configService: ConfigService<ConfigurationType>,\n  ) {}\n  catch(exception: ThrottlerException, host: ArgumentsHost): void {\n    const ctx = host.switchToHttp();\n    const res = ctx.getResponse<Response>();\n    const req = ctx.getRequest<Request>();\n\n    const message = 'Too many requests';\n    const code = HttpStatus.TOO_MANY_REQUESTS;\n    const resBody = this.buildResponseBody(req.url, message);\n    res.status(code).json(resBody);\n  }\n\n  private buildResponseBody(reqUrl: string, message: string) {\n    if (this.configService.get('nodeEnv') === 'production') {\n      return {\n        timestamp: new Date().toISOString(),\n        path: null,\n        message: 'Too many requests',\n      };\n    } else {\n      return {\n        timestamp: new Date().toISOString(),\n        path: reqUrl,\n        message,\n      };\n    }\n  }\n}\n"],"names":["ThrottlerExceptionFilter","catch","exception","host","ctx","switchToHttp","res","getResponse","req","getRequest","message","code","HttpStatus","TOO_MANY_REQUESTS","resBody","buildResponseBody","url","status","json","reqUrl","configService","get","timestamp","Date","toISOString","path","constructor"],"mappings":";;;;+BAYaA;;;eAAAA;;;wBAPN;wBACuB;2BAGK;;;;;;;;;;AAG5B,IAAA,AAAMA,2BAAN,MAAMA;IAIXC,MAAMC,SAA6B,EAAEC,IAAmB,EAAQ;QAC9D,MAAMC,MAAMD,KAAKE,YAAY;QAC7B,MAAMC,MAAMF,IAAIG,WAAW;QAC3B,MAAMC,MAAMJ,IAAIK,UAAU;QAE1B,MAAMC,UAAU;QAChB,MAAMC,OAAOC,kBAAU,CAACC,iBAAiB;QACzC,MAAMC,UAAU,IAAI,CAACC,iBAAiB,CAACP,IAAIQ,GAAG,EAAEN;QAChDJ,IAAIW,MAAM,CAACN,MAAMO,IAAI,CAACJ;IACxB;IAEQC,kBAAkBI,MAAc,EAAET,OAAe,EAAE;QACzD,IAAI,IAAI,CAACU,aAAa,CAACC,GAAG,CAAC,eAAe,cAAc;YACtD,OAAO;gBACLC,WAAW,IAAIC,OAAOC,WAAW;gBACjCC,MAAM;gBACNf,SAAS;YACX;QACF,OAAO;YACL,OAAO;gBACLY,WAAW,IAAIC,OAAOC,WAAW;gBACjCC,MAAMN;gBACNT;YACF;QACF;IACF;IA5BAgB,YACE,AAAiBN,aAA+C,CAChE;aADiBA,gBAAAA;IAChB;AA2BL"}